---
import PbImage from './PbImage.astro';

const { offre } = Astro.props;

---

<div class="relative bg-white rounded-2xl shadow-lg hover:shadow-2xl transition-all overflow-hidden border-2 border-red-100 hover:border-red-300 group">
    <button 
        class="absolute top-3 right-3 z-10 p-2 rounded-full bg-white shadow-md hover:scale-110 transition favorite-btn"
        data-id={offre.id}
        data-favori={offre.favori}
    >
        <svg class="w-6 h-6 transition-all" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
        </svg>
    </button>

    <div class="p-5">
        <PbImage 
            record={offre} 
            imageField={offre.images[0]}
            class="w-full h-48 object-cover rounded-lg mb-4 shadow-md" 
        />

        <h2 class="text-2xl font-bold text-red-700 mb-1">
            {offre.nomMaison}
        </h2>
        <div class="flex items-center gap-2 mb-3">
            <p class="text-red-800 text-sm font-medium">{offre.adresse}</p>
        </div>
        <p class="text-3xl font-extrabold text-rose-500 mb-4">
            {offre.prix} €<span class="text-base font-normal text-red-400"> / mois</span>
        </p>
        <div class="grid grid-cols-3 gap-2 p-3 bg-linear-to-r from-red-50 to-rose-50 rounded-xl border border-red-100">
            <div class="text-center">
                <p class="text-2xl font-bold text-red-700">{offre.nbChambres}</p>
                <p class="text-xs text-red-500 uppercase">Chambres</p>
            </div>
            <div class="text-center border-x border-red-200">
                <p class="text-2xl font-bold text-red-700">{offre.nbSdb}</p>
                <p class="text-xs text-red-500 uppercase">Salle de bain</p>
            </div>
            <div class="text-center">
                <p class="text-2xl font-bold text-red-700">{offre.surface}</p>
                <p class="text-xs text-red-500 uppercase">m²</p>
            </div>
        </div>
        <a href={`/offres/surface/[surface].astro${offre.id}`}>Voir plus</a>
    </div>
</div>

<script>
    document.querySelectorAll('.favorite-btn').forEach(btn => {
        const id = (btn as HTMLElement).dataset.id;
        const favori = (btn as HTMLElement).dataset.favori === 'true';
        const svg = btn.querySelector('svg') as SVGElement;
        
        const updateHeartStyle = (isFavori: boolean) => {
            if (isFavori) {
                svg.classList.add('fill-red-500', 'text-red-500');
                svg.classList.remove('fill-none', 'text-gray-400');
            } else {
                svg.classList.remove('fill-red-500', 'text-red-500');
                svg.classList.add('fill-none', 'text-gray-400');
            }
        };
        
        updateHeartStyle(favori);
        
        btn.addEventListener('click', (e) => {
            e.preventDefault();
            if (!svg) return;
            
            let favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
            
            if (favorites.includes(id)) {
                favorites = favorites.filter((fav: string) => fav !== id);
                updateHeartStyle(false);
            } else {
                favorites.push(id);
                updateHeartStyle(true);
            }
            
            localStorage.setItem('favorites', JSON.stringify(favorites));
        });
    });
</script>
