---
import { Image } from "astro:assets";

const { offre } = Astro.props;
---

<div class="relative bg-linear-to-br from-red-50 to-white rounded-2xl shadow-red-900/80 shadow-lg transition overflow-hidden border border-red-100 group">
    <button 
        class="absolute top-3 right-3 z-10 p-2 rounded-full bg-white shadow-md hover:scale-110 transition favorite-btn"
        data-id={offre.id}
        data-favori={offre.favori}
    >
        <svg class="w-6 h-6 transition-all" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
        </svg>
    </button>

    <div class="p-5">
        <Image 
            src={offre.imgUrl} 
            alt={offre.nomMaison} 
            class="w-full h-48 object-cover rounded-lg mb-4 shadow-md" 
        />

        <h2 class="text-2xl font-bold text-red-700 mb-1">
            {offre.nomMaison}
        </h2>

        <p class="text-red-600/80 mb-3 text-sm">
            {offre.adresse}
        </p>

        <p class="text-3xl font-extrabold text-pink-600 mb-4">
            {offre.prix} € <span class="text-sm font-medium text-red-500">/ mois</span>
        </p>

        <div class="flex justify-between text-sm text-red-700 bg-red-100/60 rounded-lg px-4 py-2">
            <span class="font-medium">{offre.nbChambres} chambres</span>
            <span class="font-medium">{offre.nbSdb} Salle de bain</span>
            <span class="font-medium">{offre.surface} m²</span>
        </div>
    </div>
</div>

<script>
    document.querySelectorAll('.favorite-btn').forEach(btn => {
        const id = (btn as HTMLElement).dataset.id;
        const favori = (btn as HTMLElement).dataset.favori === 'true';
        const svg = btn.querySelector('svg') as SVGElement;
        
        const updateHeartStyle = (isFavori: boolean) => {
            if (isFavori) {
                svg.classList.add('fill-red-500', 'text-red-500');
                svg.classList.remove('fill-none', 'text-gray-400');
            } else {
                svg.classList.remove('fill-red-500', 'text-red-500');
                svg.classList.add('fill-none', 'text-gray-400');
            }
        };
        
        updateHeartStyle(favori);
        
        btn.addEventListener('click', (e) => {
            e.preventDefault();
            if (!svg) return;
            
            let favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
            
            if (favorites.includes(id)) {
                favorites = favorites.filter((fav: string) => fav !== id);
                updateHeartStyle(false);
            } else {
                favorites.push(id);
                updateHeartStyle(true);
            }
            
            localStorage.setItem('favorites', JSON.stringify(favorites));
        });
    });
</script>
